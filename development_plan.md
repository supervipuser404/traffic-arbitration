# Детальный план разработки

Этот документ описывает пошаговый план работ по приведению проекта в соответствие с техническим заданием.

## 1. Бэкенд API

### 1.1. Реализация API для получения новостей

-   **Задача:** Заменить эндпоинт `GET /news` на `POST /qaz.html`.
-   **Шаги:**
    1.  Создать новый роут `POST /qaz.html` в `python/traffic_arbitration/web/main.py`.
    2.  Реализовать парсинг и валидацию параметров из тела запроса: `request`, `b`, `after`.
    3.  Разработать логику фильтрации и пагинации новостей на основе полученных параметров.
    4.  Обеспечить обратную совместимость или определить стратегию миграции со старого эндпоинта.
    5.  Удалить старый эндпоинт `GET /news`.

### 1.2. Реализация API для Push-уведомлений

-   **Задача:** Добавить эндпоинты для регистрации устройств и отправки событий.
-   **Шаги:**
    1.  Создать роут `/api/v1/device/get-id` для получения уникального идентификатора устройства.
    2.  Создать роут `/api/v1/device/register` для регистрации устройства и сохранения его токена в БД.
    3.  Создать роут `/api/v1/event/{eventType}` для обработки событий от клиента (например, `click`, `close`).
    4.  Интегрировать с сервисом отправки push-уведомлений (например, Firebase Cloud Messaging).

### 1.3. Реализация логики динамической вставки тизеров

-   **Задача:** Внедрить рекламные блоки в контент статьи на стороне бэкенда.
-   **Шаги:**
    1.  Разработать функцию, которая принимает текст статьи и вставляет HTML-код тизеров после каждого N-го абзаца.
    2.  Интегрировать эту функцию в эндпоинт, отдающий полную статью (`/{category}/{article-slug}/full/`).
    3.  Предусмотреть возможность настройки количества абзацев и контента тизеров через конфигурацию или админ-панель.

## 2. Структура URL (Роутинг)

-   **Задача:** Перейти от URL с ID к семантическим URL.
-   **Шаги:**
    1.  Добавить в модель `Article` поля `slug` и `category`.
    2.  Реализовать механизм генерации уникального слага (`slug`) при создании/редактировании статьи.
    3.  Обновить роутинг в `python/traffic_arbitration/web/main.py` для поддержки URL вида `/{category}/{article-slug}/` и `/{category}/{article-slug}/full/`.
    4.  Настроить редиректы со старых URL (`/articles/{article_id}`) на новые для сохранения SEO.

## 3. Фронтенд

### 3.1. Реализация механики "Click Hijacking"

-   **Задача:** Добавить логику перехвата кликов на стороне клиента.
-   **Шаги:**
    1.  На стороне бэкенда: передавать URL для редиректа в переменной `bg` в основной шаблон.
    2.  На стороне фронтенда (`watch.js` или аналогичный):
        -   Написать скрипт, который по клику на любую ссылку или элемент страницы отменяет стандартное действие.
        -   Вместо перехода по ссылке, скрипт должен перезагружать текущую вкладку с URL, указанным в переменной `bg`.

### 3.2. Интеграция с новыми API и URL

-   **Задача:** Обновить клиентский код для работы с измененным бэкендом.
-   **Шаги:**
    1.  Обновить код получения новостей для использования эндпоинта `POST /qaz.html`.
    2.  Заменить все статические URL на страницах на новые, семантические.
    3.  Интегрировать логику работы с Push-уведомлениями: получение ID, регистрация, отправка событий.
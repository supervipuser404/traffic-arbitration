{% extends "layouts.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-{{ 'plus-circle' if not is_edit else 'pencil' }}"></i> 
        {{ 'Add Content Source' if not is_edit else 'Edit Content Source' }}
    </h1>
    <a href="{{ url_for('content_sources') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Sources
    </a>
</div>

{% if errors %}
<div class="alert alert-danger">
    <h6><i class="bi bi-exclamation-triangle"></i> Errors:</h6>
    <ul class="mb-0">
        {% for error in errors %}
        <li>{{ error }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="card">
    <div class="card-header bg-{{ 'success' if not is_edit else 'warning' }} text-white">
        <h5 class="card-title mb-0">
            <i class="bi bi-{{ 'plus-circle' if not is_edit else 'pencil' }}"></i> 
            {{ 'Add Content Source' if not is_edit else 'Edit Content Source' }}
        </h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('create_source') if not is_edit else url_for('update_source', source_id=source.id) }}">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="name" class="form-label">Source Name *</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               value="{{ form_data.name if form_data else (source.name if source else '') }}" required>
                        <small class="form-text text-muted">Human-readable name for the content source</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="domain" class="form-label">Domain *</label>
                        <input type="text" class="form-control" id="domain" name="domain" 
                               value="{{ form_data.domain if form_data else (source.domain if source else '') }}"
                               placeholder="example.com" required>
                        <small class="form-text text-muted">Primary domain for this source</small>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="source_handler" class="form-label">Source Handler</label>
                        <select class="form-select" id="source_handler" name="source_handler">
                            <option value="">Select handler...</option>
                            <option value="iadvert" 
                                    {{ 'selected' if (form_data.source_handler if form_data else (source.source_handler if source else '')) == 'iadvert' else '' }}>
                                IAdvert Scraper
                            </option>
                            <option value="custom" 
                                    {{ 'selected' if (form_data.source_handler if form_data else (source.source_handler if source else '')) == 'custom' else '' }}>
                                Custom Handler
                            </option>
                        </select>
                        <small class="form-text text-muted">Handler for processing this source</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="is_active" 
                                   name="is_active" 
                                   {{ 'checked' if (form_data.is_active if form_data else (source.is_active if source else True)) else '' }}>
                            <label class="form-check-label" for="is_active">
                                Active source
                            </label>
                        </div>
                        <small class="form-text text-muted">Whether this source is currently active</small>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" 
                          placeholder="Description of this content source...">{{ form_data.description if form_data else (source.description if source else '') }}</textarea>
                <small class="form-text text-muted">Optional description of what this source provides</small>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="aliases" class="form-label">Aliases</label>
                        <input type="text" class="form-control" id="aliases" name="aliases" 
                               value="{{ form_data.aliases if form_data else (source.aliases if source else '') }}"
                               placeholder="Alternative domains, comma separated">
                        <small class="form-text text-muted">Alternative domains, comma separated</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="old_domains" class="form-label">Old Domains</label>
                        <input type="text" class="form-control" id="old_domains" name="old_domains" 
                               value="{{ form_data.old_domains if form_data else (source.old_domains if source else '') }}"
                               placeholder="Former domains, comma separated">
                        <small class="form-text text-muted">Former domains, comma separated</small>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-end">
                <a href="{{ url_for('content_sources') }}" class="btn btn-secondary me-2">
                    <i class="bi bi-x-circle"></i> Cancel
                </a>
                <button type="submit" class="btn btn-{{ 'success' if not is_edit else 'warning' }}">
                    <i class="bi bi-{{ 'plus-circle' if not is_edit else 'pencil' }}"></i> 
                    {{ 'Create Source' if not is_edit else 'Update Source' }}
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.form-label {
    font-weight: 600;
    color: #495057;
}

.form-text {
    font-size: 0.875rem;
}

.card {
    border: 1px solid #dee2e6;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.card-header {
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.btn {
    border-radius: 0.375rem;
}

.form-control, .form-select {
    border-radius: 0.375rem;
}
</style>
{% endblock %}